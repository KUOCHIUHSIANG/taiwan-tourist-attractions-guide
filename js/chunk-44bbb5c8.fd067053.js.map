{"version":3,"sources":["webpack:///./src/views/Activity.vue?8ff5","webpack:///./src/views/Activity.vue","webpack:///src/views/Activity.vue","webpack:///./src/views/Activity.vue?2fbc","webpack:///./src/views/Activity.vue?797b"],"names":["render","_vm","this","_c","_self","staticClass","attrs","activity","lat","lng","nearbyActivities","length","nearByTitle","nearBySubTitle","_e","staticRenderFns","mixins","components","SharedPage","SharedCardsList","created","mounted","window","unmounted","data","methods","id","timeout","name","description","phone","address","startTime","endTime","city","class1","class2","websiteUrl","picture","position","charge","remarks","organizer","store","console","year","month","day","amount","computed","watch","beforeRouteUpdate","ActivityID","next","component"],"mappings":"kHAAA,W,kECAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,sBAAsB,CAACF,EAAG,aAAa,CAACG,MAAM,CAAC,2BAA2BL,EAAIM,SAAS,OAAS,CAACC,IAAKP,EAAIO,IAAKC,IAAKR,EAAIQ,QAAyC,IAAhCR,EAAIS,iBAAiBC,OAAcR,EAAG,kBAAkB,CAACG,MAAM,CAAC,oBAAoBL,EAAIS,iBAAiB,gBAAgBT,EAAIW,YAAY,oBAAoBX,EAAIY,kBAAkBZ,EAAIa,MAAM,IAEnZC,EAAkB,G,8FCkBP,GACfC,gBACAC,YACAC,kBACAC,wBAEAC,UACA,mDAEAC,UACAC,sDAEAC,YACAD,yDAEAE,OACA,OACAjB,YACAG,oBACAF,MACAC,QAGAgB,SACA,uBACA,IACA,kCAAAC,OAEA,qBAKA,OAJA,4BACAC,oBAEA,mBAAAC,yBAGA,gBAqBA,GApBA,eACAF,gBACAE,oBACAC,0BACAC,cACAC,kCACAC,sBACAC,kBACAC,yBACAC,gBACAC,gBACAC,wBACAC,kBACAC,oBACAC,gBACAC,kBACAC,uBAEA,4CACA,4CACA,4BACA,yBACA,QAEA,gCACA,yBAEA,yCAEA,yBAEA,SACA,yBACAC,4BACA,mDAEAC,iBAIA,qCACA,IACA,iBACA,kBACA,qBACA,cACA,UAEA,0CAAAC,OAAAC,QAAAC,MAAAb,OAAAc,WAEA,uBACA,mBAGA,sCACAtB,gBACAE,oBACAM,yBACAI,qBAGA,sDACA,yBAGA,SACA,yBACAK,4BACA,mDAEAC,kBAKAK,aACA,4BAEAC,OACA3C,WACA,uBAGA4C,yBACA,iBAAAC,GAAA,SACA,sBACAC,MC9IkV,I,wBCQ9UC,EAAY,eACd,EACAtD,EACAe,GACA,EACA,KACA,WACA,MAIa,aAAAuC,E","file":"js/chunk-44bbb5c8.fd067053.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Activity.vue?vue&type=style&index=0&id=68a233dd&prod&lang=scss&scoped=true&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"activity-container\"},[_c('SharedPage',{attrs:{\"initial-inside-page-data\":_vm.activity,\"center\":{lat: _vm.lat, lng: _vm.lng}}}),(_vm.nearbyActivities.length !== 0)?_c('SharedCardsList',{attrs:{\"initial-card-list\":_vm.nearbyActivities,\"initial-title\":_vm.nearByTitle,\"initial-sub-title\":_vm.nearBySubTitle}}):_vm._e()],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"activity-container\">\n    <SharedPage :initial-inside-page-data=\"activity\"\n    :center=\"{lat, lng}\"\n    />\n    <SharedCardsList v-if=\"nearbyActivities.length !== 0\"\n    :initial-card-list=\"nearbyActivities\"\n    :initial-title=\"nearByTitle\"\n    :initial-sub-title=\"nearBySubTitle\" />\n  </div>\n</template>\n\n<script>\nimport SharedPage from '../components/SharedPageForInsidePages.vue';\nimport SharedCardsList from '../components/SharedCardsList.vue';\nimport activitiesAPI from '../api/activities';\nimport { mixinResize } from \"../utils/mixin\";\nimport store from \"./../store\";\nimport { mapState } from 'vuex';\n\nexport default {\n  mixins: [mixinResize],\n  components: {\n    SharedPage,\n    SharedCardsList\n  },\n  created() {\n    this.fetchActivity(this.$route.params.ActivityID)\n  },\n   mounted() {\n    window.addEventListener('resize', this.getDimensions)\n  },\n  unmounted() {\n    window.removeEventListener('resize', this.getDimensions)\n  },\n  data() {\n    return {\n      activity: {},\n      nearbyActivities: [],\n      lat: 0,\n      lng: 0,\n    }\n  },\n  methods: {\n    async fetchActivity(id) {\n      try {\n        const response = await activitiesAPI.getActivity({ id });\n        \n        if(response.data.length === 0) {\n          this.$toast.error(\"此活動不存在\", {\n            timeout: 1500\n          })\n          this.$router.push({ name: 'search-activity' })\n          return\n        }\n        const [activityData] = response.data\n        this.activity = {\n          id: activityData.ActivityID,\n          name: activityData.ActivityName,\n          description: activityData.Description,\n          phone: activityData.Phone,\n          address: activityData.Address ? activityData.Address : '未提供',\n          startTime: activityData.StartTime,\n          endTime: activityData.EndTime,\n          city: activityData.City ? activityData.City : '未提供',\n          class1: activityData.Class1,\n          class2: activityData.Class2,\n          websiteUrl: activityData.WebsiteUrl,\n          picture: activityData.Picture,\n          position: activityData.Position,\n          charge: activityData.Charge,\n          remarks: activityData.Remarks,\n          organizer: activityData.Organizer\n        }\n        this.lat = this.activity.position.PositionLat\n        this.lng = this.activity.position.PositionLon\n        if (this.activity.city !== '未提供') {\n          let citiesArr = this.cities.map((city)=> {\n            return city.name\n          })\n          let cityIndex = citiesArr.indexOf(this.activity.city)\n          let engCity = this.cities[cityIndex].engName\n          \n          this.fetchRecentActivitiesByCity(engCity)\n        } else {\n          this.nearbyActivities = []\n        }\n      } catch(error) {\n        if(error.response.status === 401) {\n          store.dispatch(\"getToken\");\n          this.fetchActivity(this.$route.params.ActivityID)\n        } else {\n          console.log(error)\n        }\n      }\n    },\n    async fetchRecentActivitiesByCity(city) {\n      try { \n        const date = new Date();\n        const year = date.getFullYear();\n        let month = date.getMonth() + 1;\n        let day = date.getDate();\n        const amount = 4\n\n        const response = await activitiesAPI.getRecentActivitiesByCity({year, month, day, city, amount})\n\n        if (response.statusText !== \"OK\") {\n          throw new Error(response);\n        }\n        \n        this.nearbyActivities = response.data.map((activity) => ({\n          id: activity.ActivityID,\n          name: activity.ActivityName,\n          city: activity.City ? activity.City : \"未提供\",\n          picture: activity.Picture,\n        }))\n        \n        this.nearbyActivities = this.nearbyActivities.filter((nearbyActivity) => {\n          return nearbyActivity.id !== this.activity.id\n        })\n\n      } catch (error) {\n        if(error.response.status === 401) {\n          store.dispatch(\"getToken\");\n          this.fetchActivity(this.$route.params.ActivityID)\n        } else {\n          console.log(error)\n        }\n      }\n    }\n  },\n  computed: {\n    ...mapState(['cities'])\n  },\n  watch: {\n    activity() {\n      this.getDimensions()\n    }\n  },\n  beforeRouteUpdate (to, from, next) {\n    const { ActivityID } = to.params\n    this.fetchActivity(ActivityID)\n    next()\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.activity-container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 88px 15px 0;\n  margin-bottom: 71px;\n}\n\n@media screen and (min-width: 768px) {\n  .activity-container {\n    padding: 140px 45px 0;\n    margin-bottom: 120px;\n  }\n}\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Activity.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Activity.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Activity.vue?vue&type=template&id=68a233dd&scoped=true&\"\nimport script from \"./Activity.vue?vue&type=script&lang=js&\"\nexport * from \"./Activity.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Activity.vue?vue&type=style&index=0&id=68a233dd&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"68a233dd\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}